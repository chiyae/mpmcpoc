
{
  "entities": {
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an inventory item with its details and stock information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Item entity, same as itemCode."
        },
        "itemCode": {
          "type": "string",
          "description": "Auto-generated unique code for the item."
        },
        "genericName": {
          "type": "string",
          "description": "The generic or chemical name of the item."
        },
        "brandName": {
          "type": "string",
          "description": "The trade or brand name of the item (optional)."
        },
        "formulation": {
          "type": "string",
          "description": "The physical form of the item.",
          "enum": ["Tablet", "Capsule", "Syrup", "Injection", "Cream", "Lotion", "Medical Supply", "Consumable"]
        },
        "strengthValue": {
          "type": "number",
          "description": "The numerical value of the item's strength (e.g., 500 for 500mg)."
        },
        "strengthUnit": {
          "type": "string",
          "description": "The unit for the item's strength (e.g., 'mg', '%')."
        },
        "concentrationValue": {
            "type": "number",
            "description": "The numerical value of the liquid's concentration numerator (e.g., 250 for 250mg/5ml)."
        },
        "concentrationUnit": {
            "type": "string",
            "description": "The unit for the liquid's concentration (e.g., 'mg/ml', 'mg/5ml')."
        },
        "packageSizeValue": {
          "type": "number",
          "description": "The numerical value of the item's package size (e.g., 100 for 100ml)."
        },
        "packageSizeUnit": {
          "type": "string",
          "description": "The unit for the item's package size (e.g., 'ml', 'g', 'tablets')."
        },
        "category": {
          "type": "string",
          "description": "Category of the item (Medicine, Medical Supply, Consumable)."
        },
        "unitOfMeasure": {
          "type": "string",
          "description": "The base unit for transactions (e.g., tablet, bottle, box)."
        },
        "dispensaryReorderLevel": {
          "type": "number",
          "description": "Reorder level for the item in the dispensary."
        },
        "bulkStoreReorderLevel": {
          "type": "number",
          "description": "Reorder level for the item in the bulk store."
        },
        "unitCost": {
          "type": "number",
          "description": "Unit cost of the item."
        },
        "sellingPrice": {
          "type": "number",
          "description": "Selling price of the item."
        }
      },
      "required": [
        "id",
        "itemCode",
        "genericName",
        "formulation",
        "category",
        "unitOfMeasure",
        "dispensaryReorderLevel",
        "bulkStoreReorderLevel",
        "unitCost",
        "sellingPrice"
      ]
    },
    "Stock": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stock",
      "type": "object",
      "description": "Represents the stock level of a specific batch of an item at a specific location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Stock entity."
        },
        "itemId": {
          "type": "string",
          "description": "Denormalized reference to the Item's ID."
        },
        "batchId": {
          "type": "string",
          "description": "A unique identifier for the batch (e.g., a batch number)."
        },
        "locationId": {
          "type": "string",
          "description": "The ID of the location where this stock is held (e.g., 'dispensary', 'bulk-store')."
        },
        "currentStockQuantity": {
          "type": "number",
          "description": "The current quantity of this item batch at this location."
        },
        "expiryDate": {
          "type": "string",
          "format": "date-time",
          "description": "The expiry date of this specific batch."
        }
      },
      "required": [
        "id",
        "itemId",
        "batchId",
        "locationId",
        "currentStockQuantity",
        "expiryDate"
      ]
    },
    "InternalOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InternalOrder",
      "type": "object",
      "description": "Represents an internal order from one location (e.g., Dispensary) to another (e.g., Bulk Store).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InternalOrder entity."
        },
        "date": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the order (Pending, Approved, Issued, Rejected)."
        },
        "requestingLocationId": {
          "type": "string",
          "description": "ID of the location placing the order (e.g., 'dispensary')."
        },
        "items": {
          "type": "array",
          "description": "A list of items requested in the order.",
          "items": {
            "type": "object",
            "properties": {
              "itemId": { "type": "string", "description": "The ID of the requested item." },
              "quantity": { "type": "number", "description": "The quantity of the item requested." }
            },
            "required": ["itemId", "quantity"]
          }
        }
      },
      "required": [
        "id",
        "date",
        "status",
        "requestingLocationId",
        "items"
      ]
    },
    "Billing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Billing",
      "type": "object",
      "description": "Represents a patient bill for dispensed items and services.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Billing entity."
        },
        "patientName": {
          "type": "string",
          "description": "Patient's name."
        },
        "date": {
          "type": "string",
          "description": "Date of the bill.",
          "format": "date-time"
        },
        "dispensingLocationId": {
          "type": "string",
          "description": "The Location where dispensing occurred (e.g., 'dispensary')."
        },
        "isDispensed": {
          "type": "boolean",
          "description": "Flag to indicate if the items have been given to the patient."
        },
        "billType": {
            "type": "string",
            "enum": ["Walk-in", "OPD"]
        },
        "prescriptionNumber": {
            "type": "string"
        },
         "grandTotal": {
          "type": "number"
        },
        "paymentDetails": {
            "type": "object",
            "properties": {
                "method": {"type": "string"},
                "status": {"type": "string"},
                "amountTendered": {"type": "number"},
                "change": {"type": "number"}
            }
        },
        "items": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "itemId": {"type": "string"},
                    "itemName": {"type": "string"},
                    "quantity": {"type": "number"},
                    "unitPrice": {"type": "number"},
                    "total": {"type": "number"}
                }
            }
        }
      },
      "required": [
        "id",
        "patientName",
        "date",
        "dispensingLocationId",
        "grandTotal",
        "paymentDetails",
        "items"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity (matches Firebase Auth UID)."
        },
        "username": {
          "type": "string",
          "description": "Username for login (email)."
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "role": {
          "type": "string",
          "description": "User role (admin, cashier, pharmacy).",
          "enum": ["admin", "cashier", "pharmacy"]
        },
        "locationId": {
          "type": "string",
          "description": "Location this user is assigned to (e.g., 'dispensary', 'bulk-store', 'all')."
        }
      },
      "required": [
        "id",
        "username",
        "displayName",
        "role",
        "locationId"
      ]
    },
    "Vendor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vendor",
      "type": "object",
      "description": "Represents a supplier or vendor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Vendor entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the vendor."
        },
        "contactPerson": {
          "type": "string",
          "description": "Primary contact person."
        },
        "email": {
          "type": "string",
          "description": "Contact email.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Contact phone number."
        }
      },
      "required": ["id", "name", "email"]
    },
    "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Represents a billable clinic service, like a consultation or procedure.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Service entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the service."
        },
        "fee": {
          "type": "number",
          "description": "The fee for the service."
        }
      },
      "required": ["id", "name", "fee"]
    },
    "ClinicSettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClinicSettings",
      "type": "object",
      "description": "Stores general clinic-wide settings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the settings document (should be a singleton, e.g., 'clinic')."
        },
        "clinicName": {
          "type": "string",
          "description": "The official name of the clinic."
        },
        "clinicAddress": {
          "type": "string",
          "description": "The physical address of the clinic."
        },
        "clinicPhone": {
          "type": "string",
          "description": "The contact phone number for the clinic."
        },
        "currency": {
          "type": "string",
          "description": "The default currency code for the application (e.g., USD, KES)."
        }
      },
      "required": ["id", "clinicName", "currency"]
    },
    "ProcurementSession": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "ProcurementSession",
        "type": "object",
        "description": "Represents a saved state of a procurement assistant workflow.",
        "properties": {
            "id": {
                "type": "string",
                "description": "Unique identifier for the procurement session."
            },
            "createdAt": {
                "type": "string",
                "format": "date-time",
                "description": "The date and time the session was created."
            },
            "status": {
                "type": "string",
                "enum": ["Draft", "Completed"],
                "description": "The current status of the procurement session."
            },
            "procurementList": {
                "type": "array",
                "items": { "type": "string" },
                "description": "An array of item IDs included in the procurement list for this session."
            },
            "vendorQuotes": {
                "type": "object",
                "description": "A nested object storing vendor prices. Format: { itemId: { vendorId: price } }.",
                "additionalProperties": {
                    "type": "object",
                    "additionalProperties": { "type": "number" }
                }
            },
            "lpoQuantities": {
                "type": "object",
                "description": "A map of item IDs to their order quantities. Format: { itemId: quantity }.",
                "additionalProperties": { "type": "number" }
            }
        },
        "required": ["id", "createdAt", "status", "procurementList", "vendorQuotes", "lpoQuantities"]
    },
    "LocalPurchaseOrder": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "LocalPurchaseOrder",
        "type": "object",
        "description": "Represents a formal purchase order to be sent to a vendor.",
        "properties": {
            "id": { "type": "string" },
            "lpoNumber": { "type": "string" },
            "vendorId": { "type": "string" },
            "vendorName": { "type": "string" },
            "date": { "type": "string", "format": "date-time" },
            "items": {
                "type": "array",
                "items": {
                    "type": "object",
                    "properties": {
                        "itemId": { "type": "string" },
                        "itemName": { "type": "string" },
                        "quantity": { "type": "number" },
                        "unitPrice": { "type": "number" },
                        "total": { "type": "number" }
                    },
                    "required": ["itemId", "itemName", "quantity", "unitPrice", "total"]
                }
            },
            "grandTotal": { "type": "number" },
            "status": { "type": "string", "enum": ["Draft", "Sent", "Completed", "Rejected"] }
        },
        "required": ["id", "lpoNumber", "vendorId", "vendorName", "date", "items", "grandTotal", "status"]
    },
    "StockTakeSession": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "StockTakeSession",
        "type": "object",
        "description": "Represents a single stock-taking event.",
        "properties": {
            "id": { "type": "string" },
            "date": { "type": "string", "format": "date-time" },
            "locationId": { "type": "string" },
            "status": { "type": "string", "enum": ["Ongoing", "Completed"] }
        },
        "required": ["id", "date", "locationId", "status"]
    },
    "StockTakeItem": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "StockTakeItem",
        "type": "object",
        "description": "Represents a single item counted during a stock-take session.",
        "properties": {
            "id": { "type": "string" },
            "itemId": { "type": "string" },
            "itemName": { "type": "string" },
            "batchId": { "type": "string" },
            "expiryDate": { "type": "string" },
            "systemQty": { "type": "number" },
            "physicalQty": { "type": "number" },
            "variance": { "type": "number" }
        },
        "required": ["id", "itemId", "itemName", "batchId", "systemQty", "physicalQty", "variance"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/items/{itemId}",
        "definition": {
          "schema": { "$ref": "#/entities/Item" },
          "description": "Stores master data for each unique inventory item."
        }
      },
      {
        "path": "/stocks/{stockId}",
        "definition": {
            "schema": { "$ref": "#/entities/Stock" },
            "description": "Stores records of actual stock, representing a specific batch of an item at a specific location."
        }
      },
      {
        "path": "/internalOrders/{orderId}",
        "definition": {
            "schema": { "$ref": "#/entities/InternalOrder" },
            "description": "Stores requests for stock transfer between locations."
        }
      },
       {
        "path": "/billings/{billingId}",
        "definition": {
            "schema": { "$ref": "#/entities/Billing" },
            "description": "Stores patient bills."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores user information, including role and assigned location."
        }
      },
      {
        "path": "/vendors/{vendorId}",
        "definition": {
          "schema": { "$ref": "#/entities/Vendor" },
          "description": "Stores vendor information."
        }
      },
      {
        "path": "/services/{serviceId}",
        "definition": {
          "schema": { "$ref": "#/entities/Service" },
          "description": "Stores billable clinic services."
        }
      },
      {
        "path": "/settings/{settingId}",
        "definition": {
          "schema": { "$ref": "#/entities/ClinicSettings" },
          "description": "Stores application-wide settings. Only a single document with a known ID should exist here (e.g., 'clinic')."
        }
      },
      {
        "path": "/procurementSessions/{sessionId}",
        "definition": {
            "schema": { "$ref": "#/entities/ProcurementSession" },
            "description": "Stores saved procurement assistant sessions."
        }
      },
      {
        "path": "/localPurchaseOrders/{lpoId}",
        "definition": {
            "schema": { "$ref": "#/entities/LocalPurchaseOrder" },
            "description": "Stores generated Local Purchase Orders."
        }
      },
      {
          "path": "/stockTakeSessions/{sessionId}",
          "definition": {
              "schema": { "$ref": "#/entities/StockTakeSession" },
              "description": "Stores records of stock-take events."
          }
      },
      {
          "path": "/stockTakeSessions/{sessionId}/items/{itemId}",
          "definition": {
              "schema": { "$ref": "#/entities/StockTakeItem" },
              "description": "Stores the individual items counted in a stock-take session."
          }
      }
    ],
    "reasoning": "The Firestore structure has been flattened to use top-level collections for each major entity: items, stocks, internalOrders, billings, users, vendors, services, and settings. This approach is straightforward, scalable, and simplifies security rules by removing the need for complex nested path checks and `get()` calls. Security and data access can be efficiently managed by querying collections directly and using denormalized fields (like `locationId` in the `stocks` collection) to filter data based on a user's role and assigned location."
  }
}

    