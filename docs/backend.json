
{
  "entities": {
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an inventory item with its details and stock information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Item entity, same as itemCode."
        },
        "itemCode": {
          "type": "string",
          "description": "Auto-generated unique code for the item."
        },
        "genericName": {
          "type": "string",
          "description": "The generic or chemical name of the item."
        },
        "brandName": {
          "type": "string",
          "description": "The trade or brand name of the item (optional)."
        },
        "formulation": {
          "type": "string",
          "description": "The physical form of the item.",
          "enum": ["Tablet", "Capsule", "Syrup", "Injection", "Cream", "Lotion", "Medical Supply", "Consumable"]
        },
        "strengthValue": {
          "type": "number",
          "description": "The numerical value of the item's strength (e.g., 500 for 500mg)."
        },
        "strengthUnit": {
          "type": "string",
          "description": "The unit for the item's strength (e.g., 'mg', '%')."
        },
        "concentrationValue": {
            "type": "number",
            "description": "The numerical value of the liquid's concentration numerator (e.g., 250 for 250mg/5ml)."
        },
        "concentrationUnit": {
            "type": "string",
            "description": "The unit for the liquid's concentration (e.g., 'mg/ml', 'mg/5ml')."
        },
        "packageSizeValue": {
          "type": "number",
          "description": "The numerical value of the item's package size (e.g., 100 for 100ml)."
        },
        "packageSizeUnit": {
          "type": "string",
          "description": "The unit for the item's package size (e.g., 'ml', 'g', 'tablets')."
        },
        "category": {
          "type": "string",
          "description": "Category of the item (Medicine, Medical Supply, Consumable)."
        },
        "unitOfMeasure": {
          "type": "string",
          "description": "The base unit for transactions (e.g., tablet, bottle, box)."
        },
        "reorderLevel": {
          "type": "number",
          "description": "Reorder level for the item."
        },
        "unitCost": {
          "type": "number",
          "description": "Unit cost of the item."
        },
        "sellingPrice": {
          "type": "number",
          "description": "Selling price of the item."
        }
      },
      "required": [
        "id",
        "itemCode",
        "genericName",
        "formulation",
        "category",
        "unitOfMeasure",
        "reorderLevel",
        "unitCost",
        "sellingPrice"
      ]
    },
    "Batch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Batch",
      "type": "object",
      "description": "Represents a specific batch of an item with its batch number and expiry date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Batch entity."
        },
        "itemId": {
          "type": "string",
          "description": "Reference to Item. (Relationship: Item 1:N Batch)"
        },
        "batchNumber": {
          "type": "string",
          "description": "Batch number for the item."
        },
        "expiryDate": {
          "type": "string",
          "description": "Expiry date of the batch.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "itemId",
        "batchNumber",
        "expiryDate"
      ]
    },
    "Stock": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stock",
      "type": "object",
      "description": "Represents the stock level of an item batch at a specific location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Stock entity."
        },
        "itemId": {
          "type": "string",
          "description": "Denormalized reference to Item ID."
        },
        "batchId": {
          "type": "string",
          "description": "Reference to Batch."
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location (e.g. 'dispensary' or 'bulk-store')."
        },
        "currentStockQuantity": {
          "type": "number",
          "description": "Current stock quantity of the item at the location."
        },
         "expiryDate": {
          "type": "string",
          "description": "Denormalized expiry date of the batch.",
          "format": "date"
        }
      },
      "required": [
        "id",
        "itemId",
        "batchId",
        "locationId",
        "currentStockQuantity",
        "expiryDate"
      ]
    },
    "Location": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Location",
      "type": "object",
      "description": "Represents a storage location (Bulk Store or Dispensary).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Location entity."
        },
        "locationName": {
          "type": "string",
          "description": "Name of the location (Bulk Store or Dispensary)."
        }
      },
      "required": [
        "id",
        "locationName"
      ]
    },
    "InternalOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InternalOrder",
      "type": "object",
      "description": "Represents an internal order from the Dispensary to the Bulk Store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InternalOrder entity."
        },
        "date": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the order (Pending, Approved, Issued)."
        },
        "requestingLocationId": {
          "type": "string",
          "description": "ID of the location placing the order."
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "itemId": { "type": "string" },
              "quantity": { "type": "number" }
            },
            "required": ["itemId", "quantity"]
          }
        }
      },
      "required": [
        "id",
        "date",
        "status",
        "requestingLocationId",
        "items"
      ]
    },
    "Billing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Billing",
      "type": "object",
      "description": "Represents a patient bill for dispensed items.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Billing entity."
        },
        "patientName": {
          "type": "string",
          "description": "Patient's name."
        },
        "date": {
          "type": "string",
          "description": "Date of the bill.",
          "format": "date-time"
        },
        "dispensingLocationId": {
          "type": "string",
          "description": "The Location where dispensing occurred."
        },
        "isDispensed": {
          "type": "boolean",
          "description": "Flag to indicate if the items have been given to the patient."
        },
         "grandTotal": {
          "type": "number"
        },
        "paymentDetails": {
            "type": "object",
            "properties": {
                "method": {"type": "string"},
                "status": {"type": "string"},
                "amountTendered": {"type": "number"},
                "change": {"type": "number"}
            }
        },
        "items": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "itemId": {"type": "string"},
                    "itemName": {"type": "string"},
                    "quantity": {"type": "number"},
                    "unitPrice": {"type": "number"},
                    "total": {"type": "number"}
                }
            }
        }
      },
      "required": [
        "id",
        "patientName",
        "date",
        "dispensingLocationId",
        "grandTotal",
        "paymentDetails",
        "items"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Username for login (email)."
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "role": {
          "type": "string",
          "description": "User role (admin, cashier, pharmacy).",
          "enum": ["admin", "cashier", "pharmacy"]
        },
        "locationId": {
          "type": "string",
          "description": "Location this user is assigned to (e.g. 'dispensary', 'bulk-store')."
        }
      },
      "required": [
        "id",
        "username",
        "displayName",
        "role",
        "locationId"
      ]
    },
    "Vendor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vendor",
      "type": "object",
      "description": "Represents a supplier or vendor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Vendor entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the vendor."
        },
        "contactPerson": {
          "type": "string",
          "description": "Primary contact person."
        },
        "email": {
          "type": "string",
          "description": "Contact email.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Contact phone number."
        }
      },
      "required": ["id", "name", "email"]
    },
    "StockTransfer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockTransfer",
      "type": "object",
      "description": "Represents a transfer of stock between locations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StockTransfer entity."
        },
        "itemId": {
          "type": "string",
          "description": "Reference to Item. (Relationship: Item 1:N StockTransfer)"
        },
        "fromLocationId": {
          "type": "string",
          "description": "Reference to Location. Location stock is transferred from. (Relationship: Location 1:N StockTransfer as From Location)"
        },
        "toLocationId": {
          "type": "string",
          "description": "Reference to Location. Location stock is transferred to. (Relationship: Location 1:N StockTransfer as To Location)"
        },
        "quantityTransferred": {
          "type": "number",
          "description": "Quantity of stock transferred."
        },
        "date": {
          "type": "string",
          "description": "Date and time of the stock transfer.",
          "format": "date-time"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to Batch. Batch of transferred item (Relationship: Batch 1:N StockTransfer)"
        }
      },
      "required": [
        "id",
        "itemId",
        "fromLocationId",
        "toLocationId",
        "quantityTransferred",
        "date",
        "batchId"
      ]
    },
    "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Represents a billable clinic service, like a consultation or procedure.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Service entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the service."
        },
        "fee": {
          "type": "number",
          "description": "The fee for the service."
        }
      },
      "required": ["id", "name", "fee"]
    },
    "ClinicSettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClinicSettings",
      "type": "object",
      "description": "Stores general clinic-wide settings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the settings document."
        },
        "clinicName": {
          "type": "string",
          "description": "The official name of the clinic."
        },
        "clinicAddress": {
          "type": "string",
          "description": "The physical address of the clinic."
        },
        "clinicPhone": {
          "type": "string",
          "description": "The contact phone number for the clinic."
        },
        "currency": {
          "type": "string",
          "description": "The default currency code for the application (e.g., USD, KES)."
        }
      },
      "required": ["id", "clinicName", "currency"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/items/{itemId}",
        "definition": {
          "schema": { "$ref": "#/entities/Item" },
          "description": "Stores master data for each unique inventory item."
        }
      },
      {
        "path": "/stocks/{stockId}",
        "definition": {
            "schema": { "$ref": "#/entities/Stock" },
            "description": "Stores records of actual stock, representing a specific batch of an item at a specific location."
        }
      },
      {
        "path": "/internalOrders/{orderId}",
        "definition": {
            "schema": { "$ref": "#/entities/InternalOrder" },
            "description": "Stores requests for stock transfer between locations."
        }
      },
       {
        "path": "/billings/{billingId}",
        "definition": {
            "schema": { "$ref": "#/entities/Billing" },
            "description": "Stores patient bills."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores user information, including role and assigned location."
        }
      },
      {
        "path": "/vendors/{vendorId}",
        "definition": {
          "schema": { "$ref": "#/entities/Vendor" },
          "description": "Stores vendor information."
        }
      },
      {
        "path": "/services/{serviceId}",
        "definition": {
          "schema": { "$ref": "#/entities/Service" },
          "description": "Stores billable clinic services."
        }
      },
      {
        "path": "/settings/{settingId}",
        "definition": {
          "schema": { "$ref": "#/entities/ClinicSettings" },
          "description": "Stores application-wide settings. Only a single document with a known ID should exist here (e.g., 'clinic')."
        }
      }
    ],
    "reasoning": "The Firestore structure is simplified to use top-level collections for each major entity: items, stocks, internalOrders, billings, users, vendors, services, and settings. This approach is straightforward and scalable. We will use denormalization within documents (e.g., storing `itemId` in the `stocks` collection) and query-based security rules to enforce access control, rather than relying on complex nested paths. For instance, a user's access to stock information will be determined by matching their assigned `locationId` with the `locationId` in the `stocks` documents, which is an efficient and secure pattern."
  }
}
